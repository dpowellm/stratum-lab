==============================================================================
  STRATUM EVENT SCHEMA VALIDATION -- v6 GRAPH DISCOVERY REFRAME
  Checks 18-20: error context, state access, routing decisions
==============================================================================

==============================================================================
  CHECK 18: ERROR CONTEXT IN EVENTS
==============================================================================

  [+] EventLogger.push_active_node exists                 PASS
  [+] EventLogger.pop_active_node exists                  PASS
  [+] EventLogger.current_node exists                     PASS
  [+] EventLogger.record_error_context exists             PASS

  [+] push_active_node stacks correctly                   PASS
  [+] pop_active_node returns top node                    PASS
  [+] record_error_context captures stack                 PASS
      active_stack: ['test:AgentA:main.py:10', 'test:AgentB:main.py:20']

  [+] error event passes validate_event                   PASS
  [+] error event has active_node_stack                   PASS
      active_node_stack: ['test:AgentA:main.py:10', 'test:AgentB:main.py:20']
  [+] active_node_stack has 2 entries                     PASS

==============================================================================
  CHECK 19: STATE ACCESS EVENTS
==============================================================================

  [+] state.access in STATE_ACCESS_EVENT_TYPES            PASS
      STATE_ACCESS_EVENT_TYPES = {'state.access'}
  [+] state.access event passes validate_event            PASS
  [+] state.access payload has required fields            PASS
      state_key=shared_memory.research_notes
      accessor_node=test:AgentA:main.py:10
      access_type=read
  [+] state.access (write) passes validate_event          PASS

==============================================================================
  CHECK 20: ROUTING DECISION EVENTS
==============================================================================

  [+] routing.decision in ROUTING_DECISION_EVENT_TYPES    PASS
      ROUTING_DECISION_EVENT_TYPES = {'routing.decision'}
  [+] routing.decision event passes validate_event        PASS
  [+] routing.decision payload has required fields        PASS
      decision_type=next_agent
      source_node=test:Router:main.py:5
      selected_target=test:AgentA:main.py:10
      candidates (3): ['test:AgentA:main.py:10', 'test:AgentB:main.py:20', 'test:AgentC:main.py:30']
  [+] routing.decision (tool_selection) validates         PASS

==============================================================================
  RUN RECORD INTEGRATION: state_access_count + routing_decision_count
==============================================================================

  [+] run_record.state_access_count == 2                  PASS
      state_access_count = 2
  [+] run_record.routing_decision_count == 2              PASS
      routing_decision_count = 2
  [+] run_record.total_events == 9                        PASS
      total_events = 9
  [+] type_counts includes state.access                   PASS
  [+] type_counts includes routing.decision               PASS
  [+] error_summary.total_errors == 1                     PASS

==============================================================================
  EDGE CASE: Run with no state/routing events
==============================================================================

  [+] state_access_count == 0 when none present           PASS
  [+] routing_decision_count == 0 when none present       PASS

------------------------------------------------------------------------------
  Results: 26 passed, 0 failed, 26 total
------------------------------------------------------------------------------

==============================================================================
  ALL CHECKS PASSED
==============================================================================
