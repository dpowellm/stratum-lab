--------------------- CHECK 9: Behavioral Record Matches stratum-graph Schema ----------------------

3. validate_behavioral_record()

  [+] validate_behavioral_record returns True
  [+] No missing fields

4. Top-Level Key Verification

  [+] Record has exactly 9 top-level keys
  [+] Key present: edge_validation
  [+] Key present: emergent_edges
  [+] Key present: error_propagation
  [+] Key present: execution_metadata
  [+] Key present: failure_modes
  [+] Key present: monitoring_baselines
  [+] Key present: node_activation
  [+] Key present: repo_full_name
  [+] Key present: schema_version
  [+] repo_full_name is a string
  [+] schema_version == 'v6'

5. edge_validation structure

  [+] edge_validation is a dict
  [+] edge_validation has 'dead_edges' key
  [+] edge_validation has 'activation_rates' key
  [+] dead_edges is a list
  [+] activation_rates is a dict
  [+] dead_edges[0] has 'edge_id'
  [+] dead_edges[0] has 'source'
  [+] dead_edges[0] has 'target'
  [+] activation_rates['e1'] has traversal_count
  [+] activation_rates['e1'] has activation_rate

6. emergent_edges structure

  [+] emergent_edges is a list
  [+] emergent_edges has 2 entries
  [+] emergent_edges[0] has 'discovery_type'
  [+] emergent_edges[0] has 'detection_heuristic'
  [+] emergent_edges[0] discovery_type is a string
  [+] emergent_edges[0] detection_heuristic is a string
  [+] emergent_edges[1] has 'discovery_type'
  [+] emergent_edges[1] has 'detection_heuristic'
  [+] emergent_edges[1] discovery_type is a string
  [+] emergent_edges[1] detection_heuristic is a string

7. node_activation structure

  [+] node_activation is a dict
  [+] node_activation has 'always_active' list
  [+] node_activation has 'conditional' list
  [+] node_activation has 'never_active' list
  [+] always_active has 4 entries
  [+] conditional has 3 entries
  [+] never_active has 1 entries
  [+] All node_activation entries are strings

8. error_propagation structure

  [+] error_propagation is a list
  [+] error_propagation has 2 traces
  [+] error_propagation[0] is a dict
  [+] error_propagation[0] has 'error_source_node'
  [+] error_propagation[0] has 'structural_predicted_path'
  [+] error_propagation[0] structural_predicted_path is a list
  [+] error_propagation[1] is a dict
  [+] error_propagation[1] has 'error_source_node'
  [+] error_propagation[1] has 'structural_predicted_path'
  [+] error_propagation[1] structural_predicted_path is a list

CHECK 26. Rich error propagation fields

  [+] At least one error_propagation trace has rich schema fields

9. failure_modes structure

  [+] failure_modes is a list
  [+] failure_modes has 3 entries
  [+] failure_modes[0] has 'finding_id'
  [+] failure_modes[0] has 'manifestation_observed'
  [+] failure_modes[0] finding_id is a string
  [+] failure_modes[0] manifestation_observed is a bool
  [+] failure_modes[1] has 'finding_id'
  [+] failure_modes[1] has 'manifestation_observed'
  [+] failure_modes[1] finding_id is a string
  [+] failure_modes[1] manifestation_observed is a bool
  [+] failure_modes[2] has 'finding_id'
  [+] failure_modes[2] has 'manifestation_observed'
  [+] failure_modes[2] finding_id is a string
  [+] failure_modes[2] manifestation_observed is a bool

10. monitoring_baselines structure

  [+] monitoring_baselines is a list
  [+] monitoring_baselines has 4 entries
  [+] monitoring_baselines[0] has 'metric'
  [+] monitoring_baselines[0] has 'observed_baseline'
  [+] monitoring_baselines[0] has 'threshold'
  [+] monitoring_baselines[0] metric is a string
  [+] monitoring_baselines[0] observed_baseline is numeric
  [+] monitoring_baselines[0] threshold is numeric
  [+] monitoring_baselines[1] has 'metric'
  [+] monitoring_baselines[1] has 'observed_baseline'
  [+] monitoring_baselines[1] has 'threshold'
  [+] monitoring_baselines[1] metric is a string
  [+] monitoring_baselines[1] observed_baseline is numeric
  [+] monitoring_baselines[1] threshold is numeric
  [+] monitoring_baselines[2] has 'metric'
  [+] monitoring_baselines[2] has 'observed_baseline'
  [+] monitoring_baselines[2] has 'threshold'
  [+] monitoring_baselines[2] metric is a string
  [+] monitoring_baselines[2] observed_baseline is numeric
  [+] monitoring_baselines[2] threshold is numeric
  [+] monitoring_baselines[3] has 'metric'
  [+] monitoring_baselines[3] has 'observed_baseline'
  [+] monitoring_baselines[3] has 'threshold'
  [+] monitoring_baselines[3] metric is a string
  [+] monitoring_baselines[3] observed_baseline is numeric
  [+] monitoring_baselines[3] threshold is numeric

11. JSON Serialization

  [+] json.dumps(record) succeeds
  [+] Serialized JSON is 5697 bytes
  [+] Round-trip deserialized record is still valid

12. Complete Behavioral Record

                                     Behavioral Record Summary                                      
+--------------------------------------------------------------------------------------------------+
| Field                | Type | Value / Summary                                                    |
|----------------------+------+--------------------------------------------------------------------|
| repo_full_name       | str  | test-org/crewai-research-crew                                      |
|----------------------+------+--------------------------------------------------------------------|
| schema_version       | str  | v6                                                                 |
|----------------------+------+--------------------------------------------------------------------|
| execution_metadata   | dict | 10 keys: total_runs, successful_runs, failed_runs, framework,      |
|                      |      | stratum_lab_version, execution_timestamp, docker_image,            |
|                      |      | timeout_seconds, model_provider, model_name                        |
|----------------------+------+--------------------------------------------------------------------|
| edge_validation      | dict | dead_edges: 1, activation_rates: 4 edges                           |
|----------------------+------+--------------------------------------------------------------------|
| emergent_edges       | list | 2 emergent edges discovered                                        |
|----------------------+------+--------------------------------------------------------------------|
| node_activation      | dict | always=4, conditional=3, never=1                                   |
|----------------------+------+--------------------------------------------------------------------|
| error_propagation    | list | 2 propagation traces                                               |
|----------------------+------+--------------------------------------------------------------------|
| failure_modes        | list | 3 findings (2 manifested)                                          |
|----------------------+------+--------------------------------------------------------------------|
| monitoring_baselines | list | 4 baselines defined                                                |
+--------------------------------------------------------------------------------------------------+

+--------------------------------------- execution_metadata ---------------------------------------+
| {                                                                                                |
|   "total_runs": 3,                                                                               |
|   "successful_runs": 2,                                                                          |
|   "failed_runs": 1,                                                                              |
|   "framework": "crewai",                                                                         |
|   "stratum_lab_version": "0.1.0",                                                                |
|   "execution_timestamp": "2026-02-15T12:00:00Z",                                                 |
|   "docker_image": "stratum-runner:latest",                                                       |
|   "timeout_seconds": 300,                                                                        |
|   "model_provider": "openai",                                                                    |
|   "model_name": "gpt-4"                                                                          |
| }                                                                                                |
+--------------------------------------------------------------------------------------------------+

+---------------------------------------- edge_validation -----------------------------------------+
| {                                                                                                |
|   "dead_edges": [                                                                                |
|     {                                                                                            |
|       "edge_id": "e10",                                                                          |
|       "source": "cap_web_search_tool",                                                           |
|       "target": "ext_web_api",                                                                   |
|       "edge_type": "calls",                                                                      |
|       "runs_observed": 3,                                                                        |
|       "possible_reasons": [                                                                      |
|         "tool never invoked web API directly"                                                    |
|       ]                                                                                          |
|     }                                                                                            |
|   ],                                                                                             |
|   "activation_rates": {                                                                          |
|     "e1": {                                                                                      |
|       "traversal_count": 6,                                                                      |
|       "activation_rate": 1.0,                                                                    |
|       "never_activated": false                                                                   |
|     },                                                                                           |
|     "e2": {                                                                                      |
|       "traversal_count": 5,                                                                      |
|       "activation_rate": 0.833,                                                                  |
|       "never_activated": false                                                                   |
|     },                                                                                           |
|     "e3": {                                                                                      |
|       "traversal_count": 3,                                                                      |
|       "activation_rate": 0.5,                                                                    |
|       "never_activated": false                                                                   |
|     },                                                                                           |
|     "e10": {                                                                                     |
|       "traversal_count": 0,                                                                      |
|       "activation_rate": 0.0,                                                                    |
|       "never_activated": true                                                                    |
|     }                                                                                            |
|   }                                                                                              |
| }                                                                                                |
+--------------------------------------------------------------------------------------------------+

+----------------------------------------- emergent_edges -----------------------------------------+
| [                                                                                                |
|   {                                                                                              |
|     "edge_id": "emergent_001",                                                                   |
|     "source_node_id": "agent_reviewer",                                                          |
|     "target_node_id": "cap_web_search_tool",                                                     |
|     "edge_type": "uses",                                                                         |
|     "traversal_count": 2,                                                                        |
|     "activation_rate": 0.333,                                                                    |
|     "discovery_type": "runtime_interaction",                                                     |
|     "detection_heuristic": "event_pair_matching",                                                |
|     "significance": "medium",                                                                    |
|     "trigger_condition": "Reviewer needed additional data on run 3"                              |
|   },                                                                                             |
|   {                                                                                              |
|     "edge_id": "emergent_002",                                                                   |
|     "source_node_id": "agent_researcher",                                                        |
|     "target_node_id": "agent_reviewer",                                                          |
|     "edge_type": "delegates_to",                                                                 |
|     "traversal_count": 1,                                                                        |
|     "activation_rate": 0.167,                                                                    |
|     "discovery_type": "runtime_interaction",                                                     |
|     "detection_heuristic": "event_pair_matching",                                                |
|     "significance": "low",                                                                       |
|     "trigger_condition": "Researcher directly delegated to Reviewer bypassing Writer"            |
|   }                                                                                              |
| ]                                                                                                |
+--------------------------------------------------------------------------------------------------+

+---------------------------------------- node_activation -----------------------------------------+
| {                                                                                                |
|   "always_active": [                                                                             |
|     "agent_researcher",                                                                          |
|     "agent_writer",                                                                              |
|     "cap_llm_call",                                                                              |
|     "ds_shared_memory"                                                                           |
|   ],                                                                                             |
|   "conditional": [                                                                               |
|     "agent_reviewer",                                                                            |
|     "cap_web_search_tool",                                                                       |
|     "guard_output"                                                                               |
|   ],                                                                                             |
|   "never_active": [                                                                              |
|     "cap_summarize_tool"                                                                         |
|   ]                                                                                              |
| }                                                                                                |
+--------------------------------------------------------------------------------------------------+

+--------------------------------------- error_propagation ----------------------------------------+
| [                                                                                                |
|   {                                                                                              |
|     "trace_id": "err_trace_001",                                                                 |
|     "error_source_node": "agent_writer",                                                         |
|     "error_type": "ValueError",                                                                  |
|     "structural_predicted_path": [                                                               |
|       "agent_writer",                                                                            |
|       "ds_shared_memory",                                                                        |
|       "agent_reviewer"                                                                           |
|     ],                                                                                           |
|     "actual_observed_path": [                                                                    |
|       "agent_writer",                                                                            |
|       "ds_shared_memory",                                                                        |
|       "agent_reviewer"                                                                           |
|     ],                                                                                           |
|     "propagation_stopped_by": "",                                                                |
|     "stop_mechanism": "propagated_through",                                                      |
|     "downstream_impact": {                                                                       |
|       "nodes_affected": 2,                                                                       |
|       "downstream_errors": 1,                                                                    |
|       "downstream_tasks_failed": 0,                                                              |
|       "cascade_depth": 2                                                                         |
|     },                                                                                           |
|     "structural_prediction_match": true,                                                         |
|     "run_id": "run_002"                                                                          |
|   },                                                                                             |
|   {                                                                                              |
|     "trace_id": "err_trace_002",                                                                 |
|     "error_source_node": "agent_researcher",                                                     |
|     "error_type": "TimeoutError",                                                                |
|     "structural_predicted_path": [                                                               |
|       "agent_researcher"                                                                         |
|     ],                                                                                           |
|     "actual_observed_path": [                                                                    |
|       "agent_researcher"                                                                         |
|     ],                                                                                           |
|     "propagation_stopped_by": "agent_researcher",                                                |
|     "stop_mechanism": "retry",                                                                   |
|     "downstream_impact": {                                                                       |
|       "nodes_affected": 0,                                                                       |
|       "downstream_errors": 0,                                                                    |
|       "downstream_tasks_failed": 0,                                                              |
|       "cascade_depth": 0                                                                         |
|     },                                                                                           |
|     "structural_prediction_match": true,                                                         |
|     "run_id": "run_001"                                                                          |
|   }                                                                                              |
| ]                                                                                                |
+--------------------------------------------------------------------------------------------------+

+----------------------------------------- failure_modes ------------------------------------------+
| [                                                                                                |
|   {                                                                                              |
|     "finding_id": "STRAT-OC-002",                                                                |
|     "finding_name": "Shared state contention",                                                   |
|     "manifestation_observed": true,                                                              |
|     "precondition_id": "shared_state_no_arbitration",                                            |
|     "description": "Multiple agents write to SharedMemory without locking",                      |
|     "severity": "high",                                                                          |
|     "evidence_runs": [                                                                           |
|       "run_001",                                                                                 |
|       "run_002"                                                                                  |
|     ],                                                                                           |
|     "evidence_events": [                                                                         |
|       "evt_000042",                                                                              |
|       "evt_000078"                                                                               |
|     ]                                                                                            |
|   },                                                                                             |
|   {                                                                                              |
|     "finding_id": "STRAT-DC-002",                                                                |
|     "finding_name": "Missing delegation timeout",                                                |
|     "manifestation_observed": false,                                                             |
|     "precondition_id": "no_timeout_on_delegation",                                               |
|     "description": "Delegation chain completed within timeout in all runs",                      |
|     "severity": "none",                                                                          |
|     "evidence_runs": [],                                                                         |
|     "evidence_events": []                                                                        |
|   },                                                                                             |
|   {                                                                                              |
|     "finding_id": "STRAT-EA-001",                                                                |
|     "finding_name": "Unhandled tool failure",                                                    |
|     "manifestation_observed": true,                                                              |
|     "precondition_id": "unhandled_tool_failure",                                                 |
|     "description": "WebSearch tool failure not caught by Researcher agent",                      |
|     "severity": "medium",                                                                        |
|     "evidence_runs": [                                                                           |
|       "run_002"                                                                                  |
|     ],                                                                                           |
|     "evidence_events": [                                                                         |
|       "evt_000105"                                                                               |
|     ]                                                                                            |
|   }                                                                                              |
| ]                                                                                                |
+--------------------------------------------------------------------------------------------------+

+-------------------------------------- monitoring_baselines --------------------------------------+
| [                                                                                                |
|   {                                                                                              |
|     "metric": "agent_task_latency_p95_ms",                                                       |
|     "observed_baseline": 2450.0,                                                                 |
|     "threshold": 5000.0,                                                                         |
|     "unit": "milliseconds",                                                                      |
|     "node_scope": "agent_researcher"                                                             |
|   },                                                                                             |
|   {                                                                                              |
|     "metric": "error_propagation_rate",                                                          |
|     "observed_baseline": 0.33,                                                                   |
|     "threshold": 0.5,                                                                            |
|     "unit": "ratio",                                                                             |
|     "node_scope": "global"                                                                       |
|   },                                                                                             |
|   {                                                                                              |
|     "metric": "delegation_chain_depth_max",                                                      |
|     "observed_baseline": 3,                                                                      |
|     "threshold": 5,                                                                              |
|     "unit": "count",                                                                             |
|     "node_scope": "global"                                                                       |
|   },                                                                                             |
|   {                                                                                              |
|     "metric": "tool_call_failure_rate",                                                          |
|     "observed_baseline": 0.08,                                                                   |
|     "threshold": 0.2,                                                                            |
|     "unit": "ratio",                                                                             |
|     "node_scope": "cap_web_search_tool"                                                          |
|   }                                                                                              |
| ]                                                                                                |
+--------------------------------------------------------------------------------------------------+

--------------------------------------------- Results ----------------------------------------------

  Passed: 96
  Failed: 0
  Total:  96

  ALL CHECKS PASSED

Output saved to: C:\Users\dpowe\OneDrive\Documents\Coding 
Projects\stratum-observability\stratum-lab\eval\outputs\query-demo.txt
